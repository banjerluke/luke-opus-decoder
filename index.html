<!DOCTYPE html>

<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ogg Decoder</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/water.css@2/out/dark.css"
    />
  </head>

  <body>
    <h1>Decoder Example</h1>

    <h2>Commands</h2>
    <button type="button" id="remoteButton">Load ./test.ogg</button>

    <h2>Result</h2>
    <div>Gotta check the console logs...</div>

    <script>
      function decodeOgg(arrayBuffer) {
        var typedArray = new Uint8Array(arrayBuffer);
        var desiredSampleRate = 48000;

        var decoderWorker = new Worker("./decoderWorker.js");

        decoderWorker.postMessage({
          command: "init",
          decoderSampleRate: desiredSampleRate,
          outputBufferSampleRate: desiredSampleRate,
        });

        decoderWorker.onmessage = function (e) {
          // null means decoder is finished
          if (e.data === null) {
            console.log("done");
          } else {
            // e.data contains decoded buffers as float32 values
            console.log(e.data);
            document.querySelector("#result").innerHTML = e.data;
          }
        };

        decoderWorker.postMessage(
          {
            command: "decode",
            pages: typedArray,
          },
          [typedArray.buffer]
        );
      }

      document
        .querySelector("#remoteButton")
        .addEventListener("click", async function () {
          const result = await fetch("./test.ogg");
          decodeOgg(await result.arrayBuffer());
        });
    </script>
  </body>
</html>
